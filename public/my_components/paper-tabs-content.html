<!DOCTYPE html>
<html>
    <head>
        <link href="../bower_components/polymer/polymer.html" rel="import">
        <link href="../bower_components/paper-tabs/paper-tabs.html" rel="import">
        <link href="../bower_components/paper-material/paper-material.html" rel="import">
        <link href="../bower_components/iron-pages/iron-pages.html" rel="import">
        <link href="../bower_components/paper-card/paper-card.html" rel="import">
        <link href="../bower_components/paper-ripple/paper-ripple.html" rel="import">
        <link href="../bower_components/iron-ajax/iron-ajax.html" rel="import">
    </head>

    <dom-module id="paper-tabs-content">
        <style>
            paper-tab{
                --paper-tab-ink :#E0E0E0;
            }
            paper-tab:hover{
                background-color: #f2f2f2;
            }
            paper-tabs {
                --paper-tabs-selection-bar-color:#3f51b5;
            }
            
            paper-card:hover {
              @apply(--shadow-elevation-8dp);
            }
            paper-card{
                -o-transition: all 0.5s linear;
                -moz-transition: all 0.5s linear;
                -khtml-transition: all 0.5s linear;
                -webkit-transition: all 0.5s linear;
                -ms-transition: all 0.5s linear;
                transition: all 0.5s linear; 
                width: 310px;
                height: 60px;
                margin-top: 10px;
                display: inline-table;
                padding-top: 18px;
            }
            #loader{
                display: block;
                text-align: center;
            }
          .flex-wrap {
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
            }
            
            [id^=alphabet_]>li{
                padding-left: 0.2%;
                padding-right: 0.2%;
                font-size: 20px;
                display: inline-block;
            }
            [id^=alphabet_]>li>a{
                color: #3f51b5;
                text-decoration: none;
            }
            [id^=alphabet_]{
                list-style: none;
                display: inline-block;
                width:100%;
                padding-left: 0px;
            }
            #nav_alphabet{
                text-align: center;
            }
            
        </style>
        <template>
            <!--Chargement en ajax du contenu -->
            <iron-ajax id="get_content" last-response="{{data}}" handleAs="json"> </iron-ajax>
            <!-- Génération des listes de catégories -->
            <paper-material id="tabs" elevation="1">
                <paper-tabs selected="0">
                    <template is="dom-repeat" items="{{categories}}" as="categorie">
                        <paper-tab id="categorie_{{categorie}}" >{{categorie}}</paper-tab>
                    </template>
                </paper-tabs>
            </paper-material>
            <!--Génération de l'alphabet-->
            <paper-material elevation="1">
                <nav id="nav_alphabet">
                    <iron-pages id="iron_alphabet" selected="0">  
                        <template is="dom-repeat" items="{{categories}}"  as="categorie">
                            <ul id="alphabet_{{categorie}}">
                            <template is="dom-repeat" items="{{alphabet}}"  as="lettre">
                                <li>  
                                    <a on-tap='doLoadCategorie' href="search?categorie={{categorie}}&amp;lettre={{lettre}}">{{lettre}} </a>
                                </li>
                            </template>
                            </ul>
                        </template>
                    </iron-pages>
                </nav>
            </paper-material>
            
            
            <!-- Chargement des liens -->
            <div id="loader">
                <!-- Affichage des artists -->
                 <template is="dom-if" if="{{_isArtist(data)}}">
                     <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos">
                        <paper-card id="/search/artist/{{infos.name}}/{{infos._id}}" elevation="1">
                            <div>{{infos.name}}</div>
                            <paper-ripple></paper-ripple>
                        </paper-card> 
                     </template>
                </template>
                <!-- Affichage des albums -->
                <template is="dom-if" if="{{_isAlbum(data)}}">
                    <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos" >
                        <paper-card id="/search/artist/{{infos.name}}/albums/{{infos.titleAlbum}}/{{infos._id}}" elevation="1">
                            <div>{{infos.titleAlbum}}</div> 
                            <div> de: {{infos.name}}</div> 
                            <paper-ripple></paper-ripple>
                        </paper-card> 
                    </template>
                </template>
                <!-- Affichage des songs -->
                <template is="dom-if" if="{{_isSong(data)}}">
                    <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos">
                        <paper-card id="/search/artist/{{infos.name}}/songs/{{infos.titleSong}}/{{infos._id}}" elevation="1">
                            <div>{{infos.titleSong}}</div>
                            <div>de: {{infos.name}}</div>
                            <paper-ripple></paper-ripple>
                        </paper-card> 
                    </template>
                </template>
            </div>
        </template>
    </dom-module>

    
<script>
  // element registration
  Polymer({
    is: "paper-tabs-content",
    // add properties and methods on the element's prototype
    properties: {
        categories:{
            type: Array,
            value: []
        },
        alphabet :{
            type: Array,
            value: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z']
        }
    },
    ready: function(e){    
        var pages = document.querySelector('iron-pages');
        var tabs = document.querySelector('paper-tabs');
        tabs.addEventListener('iron-select', function(e) { 
            pages.selected = tabs.selected;
        });  
        window.onpopstate = function(e){
            if(e.state != null){
                console.log(e);
                var url = e.state.path;
                console.log(e.state.path);
                var get_content = document.querySelector("#get_content")
                get_content.url = url;
                console.log("Dans on pop state");
                get_content.generateRequest();
            }
        }
    },
    doLoadCategorie: function(e){
        e.preventDefault();
        //L'affectation de l'url lance la requête automatiquement   
        var url = e.target.href;
        if(url!=window.location){
            console.log("doLoadCategorie = "+url);
            window.history.pushState({path:url},'',url);
        }        
        //stop refreshing to the page given in
        this.$.get_content.url = url; 
        this.$.get_content.generateRequest();
        return false;
    },
    _isArtist: function (infosData) {
        var exist = false;
        if(typeof(infosData[0].titleAlbum) == "undefined" && typeof(infosData[0].titleSong) == "undefined"){
            exist = true;
        }
        return exist;
    },
    _isAlbum: function (infosData) {
        var isAlbum = false;
        if(infosData[0].titleAlbum){
            isAlbum = true;
        }
            return isAlbum;
    },
    _isSong: function (infosData) {
        var isSong = false;
        if(infosData[0].titleSong){
            isSong = true;
        }
        return isSong;
    },
      
  });  

</script>   
</html>