<!DOCTYPE html>
<html>
    <head>
        <link href="../bower_components/polymer/polymer.html" rel="import">
        <link href="../bower_components/paper-tabs/paper-tabs.html" rel="import">
        <link href="../bower_components/paper-material/paper-material.html" rel="import">
        <link href="../bower_components/iron-pages/iron-pages.html" rel="import">
        <link href="../bower_components/paper-card/paper-card.html" rel="import">
        <link href="../bower_components/paper-ripple/paper-ripple.html" rel="import">
        <link href="../bower_components/iron-ajax/iron-ajax.html" rel="import">
        <link href="../bower_components/paper-button/paper-button.html" rel="import">
        <link href="../bower_components/iron-icons/iron-icons.html" rel="import">
    </head>

    <dom-module id="paper-tabs-content">
        <style>
            paper-tab{
                --paper-tab-ink :#E0E0E0;
            }
            paper-tab:hover{
                background-color: #f2f2f2;
            }
            paper-tabs {
                --paper-tabs-selection-bar-color:#3f51b5;
            }
            
            paper-button:hover {
              @apply(--shadow-elevation-6dp);
            }
            paper-button{
                -o-transition: all 1s linear;
                -moz-transition: all 1s linear;
                -khtml-transition: all 1s linear;
                -webkit-transition: all 1s linear;
                -ms-transition: all 1s linear;
                transition: all 1s linear; 
                width: 300px;
                height: 60px;
                background: #F2F2F2;
                margin-top: 10px;
                display: inline-table;
                padding-top: 18px;
            }
            #loader{
                display: block;
                text-align: center;
                margin-top: 1%;
                
            }
          .flex-wrap {
            @apply(--layout-horizontal);
            @apply(--layout-wrap);
            }
            
            [id^=alphabet_]>li{
                padding-left: 0.2%;
                padding-right: 0.2%;
                font-size: 20px;
                display: inline-block;
            }
            [id^=alphabet_]>li>a{
                color: #3f51b5;
                text-decoration: none;
            }
            [id^=alphabet_]{
                list-style: none;
                display: inline-block;
                width:100%;
                padding-left: 0px;
            }
            #nav_alphabet{
                text-align: center;
            }
            #nav_sub_alphabet{
                text-align: center;
            }
            [id^=alphabet_sub]>li{
                padding-left: 0.2%;
                padding-right: 0.2%;
                font-size: 20px;
                display: inline-block;
            }
            [id^=alphabet_sub]>li>a{
                color: #3f51b5;
                text-decoration: none;
            }
            [id^=alphabet_sub]{
                list-style: none;
                display: inline-block;
                width:100%;
                padding-left: 0px;
            }
            paper-fab.blue {
                --paper-fab-background: #3F51B5;
                --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
            }
            .previousPage{
                display: inline-flex;
                position: relative;
                left: -42%;
                margin: 1%;
            }
            .nextPage{
                display: inline-flex;
                position: relative;
                left: 42%;
                margin: 1%;
            }
            #paginationBottom{
                margin-bottom: 5%;
            }
            .listData{
                padding-bottom: 2%;
            }
        </style>
        <template>
            <!--Chargement en ajax du contenu -->
            
            <template is="dom-if" if="{{_checkUrlParams(lettre,numPage)}}">
                <iron-ajax id="get_content" url="/search/categorie/{{categorie}}/lettre/{{lettre}}/page/{{numPage}}" last-response="{{data}}" auto handleAs="json"> </iron-ajax>
            </template>
            <iron-ajax id="get_db_info" url="/search/dbinfo" last-response="{{db_info}}" auto handleAs="json"> </iron-ajax>
            <!-- Génération des listes de catégories -->
            <paper-material elevation="1">
                <paper-tabs selected={{idxCurrentTab}}>
                    <template is="dom-repeat" items="{{categories}}" as="categorie">
                        <paper-tab id="categorie_{{categorie}}" >{{categorie}}</paper-tab>
                    </template>
                </paper-tabs>
            </paper-material>
            <!--Génération de l'alphabet-->
            <paper-material elevation="1">
                <nav id="nav_alphabet">
                    <iron-pages id="iron_alphabet" selected="0">  
                        <template is="dom-repeat" items="{{categories}}" as="categorie">
                            <ul id="alphabet_{{categorie}}">
                            <template is="dom-repeat" items="{{alphabet}}" as="lettre">
                                <li>  
                                    <a href="#/search/categorie/{{categorie}}/lettre/{{lettre}}/page/0">{{lettre}} </a>
                                </li>
                            </template>
                            </ul>
                        </template>
                                                            
                        <template is="dom-if" if="{{_isNbArtist(idxCurrentTab)}}">
                                Nous avons actuellement {{ db_info.nbArtist}} artistes !
                        </template>
                        <template is="dom-if" if="{{_isNbAlbum(idxCurrentTab)}}">
                                Nous avons actuellement {{db_info.nbAlbum}} albums !
                        </template>                      
                        <template is="dom-if" if="{{_isNbSong(idxCurrentTab)}}">
                               Nous avons actuellement {{db_info.nbSong}} musiques !
                        </template>
                    </iron-pages>
                </nav>
            </paper-material>
            
            
            <!-- Chargement des liens -->
            <template is="dom-if" if="{{_isData(data)}}">
                <div id="loader">
                        <paper-material elevation="1">
                            <a class="previousPage" href="#/search/categorie/{{categorie}}/lettre/{{lettre}}/page/{{_isPrevious(numPage)}}" tabindex="-1">
                                <paper-fab mini  icon="chevron-left" title="previous" class="blue"></paper-fab>
                            </a>
                            <a class="nextPage" href="#/search/categorie/{{categorie}}/lettre/{{lettre}}/page/{{_isNext(numPage,data)}}" tabindex="-1">
                                <paper-fab  mini icon="chevron-right" title="next" class="blue"></paper-fab>
                            </a>
                            <nav id="nav_sub_alphabet">
                                <ul id="alphabet_sub{{categorie}}">
                                    <template is="dom-repeat" items="{{alphabet}}" as="lettreIdx" index-as="idx">
                                        <li>  
                                            <a href="#/search/categorie/{{categorie}}/lettre/{{currentLetter(lettre)}}{{lettreIdx}}/page/0">{{currentLetter(lettre)}}{{lettreIdx}}</a>
                                        </li>
                                    </template>
                                </ul>
                            </nav>
                        </paper-material>
                    <!-- Affichage des artists -->
                     <template is="dom-if" if="{{_isArtist(data)}}">
                        <paper-material class="listData" elevation="1">
                            <div>Il y a actuellement {{_getNbCount(data)}} artists commençant par la lettre {{lettre}}</div>
                             <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos" index-as="idx">
                                 <template is="dom-if" if="{{_isLastElement(idx,data)}}">
                                     <paper-button on-tap='doLoadCategorie' animated id="#/search/artist/{{_encodeUri(infos.name)}}" raised>
                                         {{infos.name}}
                                     </paper-button>
                                 </template>
                             </template>
                         </paper-material>
                    </template>
                    <!-- Affichage des albums -->
                    <template is="dom-if" if="{{_isAlbum(data)}}">
                        <paper-material class="listData" elevation="1">
                            <div>Il y a actuellement {{_getNbCount(data)}} albums commençant par la lettre {{lettre}}</div>
                            <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos" index-as="idx">
                                <template is="dom-if" if="{{_isLastElement(idx,data)}}">
                                     <paper-button on-tap='doLoadCategorie' id="#/search/artist/{{_encodeUri(infos.name)}}/album/{{_encodeUri(infos.titleAlbum)}}" raised>
                                         {{infos.titleAlbum}}<br>
                                         de: {{infos.name}}
                                     </paper-button>
                                </template>
                            </template>
                         </paper-material>
                    </template>
                    <!-- Affichage des songs -->
                    <template is="dom-if" if="{{_isSong(data)}}">
                       <paper-material class="listData" elevation="1">
                           <div>Il y a actuellement {{_getNbCount(data)}} musiques commençant par la lettre {{lettre}}</div>
                            <template id="cards" class="flex-wrap" is="dom-repeat" items="{{data}}" as="infos" index-as="idx">
                                <template is="dom-if" if="{{_isLastElement(idx,data)}}">
                                     <paper-button on-tap='doLoadCategorie' id="#/search/artist/{{_encodeUri(infos.name)}}/album/{{_encodeUri(infos.albumTitre)}}/song/{{_encodeUri(infos.titleSong)}}" raised>
                                        {{infos.titleSong}}<br>
                                        de: {{infos.name}}
                                     </paper-button>
                                </template>
                            </template>
                        </paper-material>
                    </template>
                        <paper-material id="paginationBottom" elevation="1">
                            <a class="previousPage" href="#/search/categorie/{{categorie}}/lettre/{{lettre}}/page/{{_isPrevious(numPage)}}" tabindex="-1">
                                <paper-fab mini icon="chevron-left" title="previous" class="blue"></paper-fab>
                            </a>
                            <a class="nextPage" href="#/search/categorie/{{categorie}}/lettre/{{lettre}}/page/{{_isNext(numPage,data)}}" tabindex="-1">
                                <paper-fab  mini icon="chevron-right" title="next" class="blue"></paper-fab>
                            </a>
                        </paper-material>

                </div>
            </template>
        </template>
    </dom-module>

    
<script>
  // element registration
  Polymer({
    is: "paper-tabs-content",
    // add properties and methods on the element's prototype
    properties: {
        categories:{
            type: Array,
            value: ['Artists', 'Albums', 'Songs', 'Label']
        },
        alphabet :{
            type: Array,
            value: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z']
        },
        idxCurrentTab:{
            type:Number,
            value:0,
        },
        //Permet de calculer le nombre moyen d'élement par page ce nombre change c'est qu'on arrive à la fin d'une catégorie et qu'on doit hide le boutton next
         nbElement:{
            type: Number,
            value:0,
        },
        nbTotalElement:{
            type: Number,
        }
    },
    ready: function(){    
            var tabs = document.querySelector('paper-tabs');
            var pages = document.querySelector('iron-pages');
//            //on lance la requête uniquement lorsqu'on charge la page
//            this.$.get_db_info.generateRequest();
            for(var i = 0;i<this.categories.length;i++){
                if(document.location.href.search(this.categories[i])!=-1){
                    this.idxCurrentTab = i; 
                }
            }
            document.addEventListener('iron-select', function(e) { 
                var tabs = document.querySelector('paper-tabs');
                var pages = document.querySelector('iron-pages');
                pages.selected = tabs.selected;
            });  
    },

      doLoadCategorie:function(e){
          window.location.href = e.target.id;
      },
      currentLetter:function(letter){
          var currLetter;
          if(letter.length>1){
              currLetter = letter[0];
          }else{
              currLetter = letter;
          }
          return currLetter;
      },
      _checkUrlParams:function(lettre,numPage){
            var urlParamValid = false;
            var numPage = parseInt(numPage);
            if(Number.isInteger(numPage) && numPage>=0){
                urlParamValid = true;
            }
            return urlParamValid;
      },
      _isLastElement:function(idx,data){
          var showElement = true;
          if(data != null && idx == data.length-1){
              showElement = false;
          }  
          return showElement;
      },
      _getNbCount:function(infosData){
          if(infosData!=null && typeof(infosData) != "undefined"){
                return infosData[infosData.length-1].nbcount;
            }
          return 0;
      },
    _isData:function(infosData){
        var exist = false;
        if(infosData != null){
            exist = true;
        }
        return exist;
    },
    _isArtist: function (infosData) {
        var isArtist = false;
        if(infosData != null && typeof(infosData[0].titleAlbum) == "undefined" && typeof(infosData[0].titleSong) == "undefined"){
            isArtist = true;
        }
        return isArtist;
    },
    _isAlbum: function (infosData) {
        var isAlbum = false;
        if(infosData != null && infosData[0].titleAlbum){
            isAlbum = true;
        }
        return isAlbum;
    },
    _isSong: function (infosData) {
        var isSong = false;
        if(infosData != null && infosData[0].titleSong){
            isSong = true;
        }
        return isSong;
    },
    _encodeUri : function(infosData){
        return encodeURIComponent(infosData);
    },
    _isPrevious : function(numPage){
        var newNumPage =0;
        var numPage = parseInt(numPage, 10);
        if(numPage<1){           
            newNumPage = numPage;
        }
        else{
            newNumPage = numPage-1;
        }
        return newNumPage;

    },

    _isNext : function(numPage,data){
       if(data != null && data.length-1==200){
            return parseInt(numPage, 10)+1;
        }
        else{
            return parseInt(numPage, 10);
        } 
    },
    _isNbArtist:function(idxCurrentTab){
        var artist=false;
        if(this.categories[idxCurrentTab] == "Artists"){
            artist = true;
        }
        return artist;
    },
    _isNbAlbum:function(idxCurrentTab){
        var album=false;
        if(this.categories[idxCurrentTab] == "Albums"){
            album = true;
        }
        return album;
    },
    _isNbSong:function(idxCurrentTab){
        var song=false;
        if(this.categories[idxCurrentTab] == "Songs"){
            song = true;
        }
        return song;
    },

      
  });  

</script>   
</html>