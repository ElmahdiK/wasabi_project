<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">



<dom-module id="x-song">
   <template>
        <style>
            #song{
                border-bottom: 1px solid rgba(229, 229, 229, 0.51);
                padding: 15px;
                padding-left: 7%;
            }
            paper-input{
                margin-left: 9%;
                margin-right: 9%;
            }
            .li-link {
                color: inherit;
                text-decoration: none;
            }
            li:hover{
                background-color: #F2F2F2;
            }
        </style>
            <a class="li-link" href="#/search/artist/{{_encodeUri(album.name)}}/album/{{_encodeUri(album.titre)}}/song/{{_encodeUri(song.titre)}}" tabindex="-1">
                <li hidden="{{editing}}" id="song">{{song.titre}}</li>
            </a>
            <!--Créer un paper-input pour chaque composant x-song réduit grandement les performances, on crée donc ce champ de modification uniquement lorsque l'utilisateur veut modifier les titres des musiques-->
            <!--<paper-input id="edit" label="titre: {{song.titre}}" hidden="{{!editing}}" value="{{song.titre}}"></paper-input>-->
    </template>
<script>
  // element registration
  Polymer({
    is: "x-song",
    // add properties and methods on the element's prototype
    properties: {
        song:{
            type: Object,
            value: {}
        },
        album:{
            type: Object,
            value: {}
        },
    	editing: {
	    	type: Boolean,
	    	value: false,
            observer: 'editingChanged'
    	},
    },
    //Fonction permettant de gérer la création des elements paper-input : lorsqu'on clique sur le bouton de modification les paper-input de l'album correspondant sont créees
    //Le fait de ne pas créer les paper-input dans le template permet de reduire par deux le temps de chargement de la page
    editingChanged: function(){
        //on veut éditer
        if(this.editing){
            var paperInput;
            //si le paper input n'existe pas on le crée
            if(!this.$.edit){
                paperInput = document.createElement("paper-input");
                //On crée un paper input équivalent a celui ci-dessous
                //<paper-input id="edit" label="titre: {{song.titre}}" hidden="{{!editing}}" value="{{song.titre}}"></paper-input>
                paperInput.id = "edit";
                paperInput.label = this.song.titre;
                paperInput.hidden= false;
                paperInput.value=this.song.titre;
                this.$.edit = paperInput;
                Polymer.dom(this.root).appendChild(paperInput);
            }
            // le paper input existe déja
            else{
                paperInput = this.$.edit;
                paperInput.label = this.song.titre;
                paperInput.hidden= false;
                paperInput.value=this.song.titre;
            }
        }
        //on veut sauvegarder
        else{
            if(this.$.edit){
                var paperInput =  this.$.edit;
                paperInput.hidden = true;
                this.set("song.titre",paperInput.value);
            }
        }
    },
    _encodeUri : function(titre){
        return encodeURIComponent(titre);
    }
  });

</script>
</dom-module>

